!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("lodash/lodash"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng2-uselect",["exports","@angular/core","@angular/forms","lodash/lodash","@angular/common"],t):t(e["ng2-uselect"]={},e.ng.core,e.ng.forms,e.lodash,e.ng.common)}(this,function(e,t,s,n,o){"use strict";var r=function(){this.placeholder="Select an item...",this.ignoreClickElements=["a","button","input","textarea","select","option","label"]};r.decorators=[{type:t.Injectable}];var l=function(){function e(e){this.defaultConfig=e,this.serviceMethod="getItems",this.itemId="id",this.servicePipe=function(e){return e},this.disabled=!1,this.disableEmpty=!1,this.search="",this.isDropDownOpen=!1,this.highlightedIndex=0,this._onChange=function(e){},this._onTouched=function(){},this._draggableIndexes={start:undefined,over:undefined}}return e.prototype.clickedOutside=function(e){this.toggleDropDown(!1)},e.prototype.ngOnInit=function(){this.placeholder||(this.placeholder=this.defaultConfig.placeholder)},e.prototype.writeValue=function(e){var t=this;if(this.value=e,this.isMultiple()&&this.sortKey&&this.value.length)this.value=n.sortBy(this.value,function(e){if(e){if(!(e instanceof Object&&e.hasOwnProperty(t.sortKey)))throw new Error('Sort key must be a part of item. Ex: {id: 1, value: {string: "example"}, sort: 1}.');return e[t.sortKey]}}),this.normalizeSort();else if(!this.isMultiple()){if(!this.value)return;this.isScalar()||this.value[this.itemId]||(this.value=undefined)}},e.prototype.registerOnChange=function(e){this._onChange=e},e.prototype.registerOnTouched=function(e){this._onTouched=e},e.prototype.onUselectIndexChange=function(e){if(this._draggableIndexes.over=e,this._draggableIndexes.over!=this._draggableIndexes.start){var t=this.value[this._draggableIndexes.over];this.value[this._draggableIndexes.start][this.sortKey]=this._draggableIndexes.over,this.value[this._draggableIndexes.over][this.sortKey]=this._draggableIndexes.start,this.value[this._draggableIndexes.over]=this.value[this._draggableIndexes.start],this.value[this._draggableIndexes.start]=t,this._draggableIndexes.start=this._draggableIndexes.over}},e.prototype.onUselectDragstart=function(e){this._draggableIndexes.start=e,this._draggableIndexes.over=undefined,this.toggleDropDown(!1)},e.prototype.normalizeSort=function(){if(this.isMultiple()&&this.sortKey)for(var e=0;e<this.value.length;e++)this.value[e][this.sortKey]=e},e.prototype.dropDownValue=function(e){return this.dropDownValueFunc?this.dropDownValueFunc(e):e[this.itemId]},e.prototype.selectedValue=function(e){return this.selectedValueFunc?this.selectedValueFunc(e):e[this.itemId]},e.prototype.selectItem=function(t){var s=this;return this.isMultiple()?(this.isCurrent(t)?n.remove(this.value,function(e){return e[s.itemId]==t[s.itemId]}):this.deleteKey&&t[this.deleteKey]?t[this.deleteKey]=!1:this.value.push(t),this.normalizeSort()):(this.isScalar()?this.value=t[this.itemId]:this.value=t,this.deleteKey&&this.value[this.deleteKey]&&(this.value[this.deleteKey]=!1),setTimeout(function(e){s.isDropDownOpen=!1,""!=s.search&&(s.search="",s.onSearchChange())})),this._onChange(this.value),!1},e.prototype.removeItem=function(t){var s=this;if(!this.disabled){if(this.isMultiple()){if(this.deleteKey)this.value.find(function(e){return e[s.itemId]==t[s.itemId]})[this.deleteKey]=!0;else n.remove(this.value,function(e){return e[s.itemId]==t[s.itemId]});this.normalizeSort()}else this.deleteKey?this.value[this.deleteKey]=!0:this.value=undefined;this._onChange(this.value)}},e.prototype.onSearchChange=function(){var t=this;if(!this.service[this.serviceMethod])throw new Error("Method '"+this.serviceMethod+"' are missed in service");this.service[this.serviceMethod].apply(this.service,this.serviceMethodArgs&&0!=this.serviceMethodArgs.length?this.serviceMethodArgs:[this.search]).pipe(function(e){return t.servicePipe.apply(undefined,[e].concat(t.pipeArgs))}).subscribe(function(e){t.items=e}),this.highlightedIndex=0},e.prototype.onItemDrop=function(e){this.normalizeSort()},e.prototype.onSearchKeydown=function(e){switch(e.keyCode){case 40:this.highlightedIndex<this.items.length-1&&this.highlightedIndex++;break;case 38:0<this.highlightedIndex&&this.highlightedIndex--;break;case 13:this.selectItem(this.items[this.highlightedIndex]);break;case 27:this.toggleDropDown(!1)}},e.prototype.isMultiple=function(){return this.value instanceof Array},e.prototype.isScalar=function(){return!this.isMultiple()&&"object"!=typeof this.value&&"undefined"!=typeof this.value},e.prototype.toggleDropDown=function(e,t){var s=this;if(void 0===e&&(e=!0),!this.disabled&&this.service){if(t){if(-1!==this.defaultConfig.ignoreClickElements.indexOf(t.target.tagName.toLowerCase())&&!t.target.classList.contains("uselect__btn-dropdown"))return;if(t.preventDefault(),t.stopPropagation(),"button"==t.target.tagName.toLowerCase()||"button"==t.target.parentNode.tagName.toLowerCase())return}(this.isDropDownOpen=e)?(this.items||this.onSearchChange(),setTimeout(function(e){s.uselectSearch.nativeElement.focus()})):""!=this.search&&(this.search="",this.onSearchChange())}},e.prototype.isCurrent=function(t){var s=this;return!(!this.value||this.value&&this.deleteKey&&this.value[this.deleteKey])&&(this.isMultiple()?0!=this.value.length&&n.some(this.value,function(e){return!(e[s.itemId]!=t[s.itemId]||s.deleteKey&&t[s.deleteKey])}):!(!this.isScalar()||this.value!=t[this.itemId]||this.deleteKey&&t[this.deleteKey])||this.value[this.itemId]==t[this.itemId])},e.prototype.arrValue=function(){return this.value},e.prototype.trackByIndex=function(e,t){return e},e}();l.decorators=[{type:t.Component,args:[{selector:"uselect",template:'<div\n  class="uselect__holder"\n  tabindex="0"\n  [class.uselect__dropdown--open]="isDropDownOpen"\n  [class.uselect__holder--disabled]="disabled">\n  <div class="uselect__select input-group"\n    [class.uselect___select--has-value]="(!isMultiple() && value) || (isMultiple() && 0 < arrValue().length)"\n    (click)="toggleDropDown(true, $event)">\n    <div class="form-control">\n      <div *ngIf="value && isMultiple() && 0 < arrValue().length"\n        class="uselect__selected-items"\n        [uselectSortableData]="value">\n        <ng-container\n          *ngFor="let selectedItem of value; let i = index; trackByIndex">\n          <div *ngIf="!deleteKey || !selectedItem[deleteKey]"\n            class="uselect__select-item" [uselectSortableIndex]="sortKey ? i : undefined"\n            (onUselectIndexChange)="onUselectIndexChange($event)"\n            (onUselectDragstart)="onUselectDragstart($event)">\n            <span class="uselect__select-item-template">\n              <ng-container\n                *ngTemplateOutlet="selectTemplate; context: {$implicit: selectedItem}"></ng-container>\n              <ng-container\n                *ngIf="!selectTemplate">\n                {{selectedValue(selectedItem)}}\n              </ng-container>\n            </span>\n            <div class="btn-group ml-auto">\n              <button *ngIf="sortKey"\n                type="button" class="btn btn-light btn-sm" aria-label="Move"\n                uselectSortableHandle>\n                <span aria-hidden="true">&#x2195;</span>\n              </button>\n              <button type="button" class="btn btn-light btn-sm" aria-label="Move"\n                (click)="removeItem(selectedItem)">\n                <span aria-hidden="true">&times;</span>\n              </button>\n            </div>\n          </div>\n        </ng-container>\n      </div>\n      <div *ngIf="value && !isMultiple() && (!deleteKey || !value[deleteKey])" class="uselect__selected-items">\n        <div class="uselect__select-item">\n          <ng-container\n            *ngTemplateOutlet="selectTemplate; context: {$implicit: value}"></ng-container>\n          <ng-container\n            *ngIf="!selectTemplate">\n            {{selectedValue(value)}}\n          </ng-container>\n          <div class="btn-group ml-auto">\n            <button *ngIf="!disableEmpty"\n              type="button" class="btn btn-light btn-sm" aria-label="Move"\n              (click)="removeItem(selectedItem)">\n              <span aria-hidden="true">&times;</span>\n            </button>\n          </div>\n        </div>\n      </div>\n      <div *ngIf="(!value || (deleteKey && (value && value[deleteKey]))) || 0 == arrValue().length"\n        class="uselect__placeholder">\n        {{placeholder}}\n      </div>\n    </div>\n    <div *ngIf="service && isMultiple()" class="input-group-append">\n      <button class="uselect__btn-dropdown btn btn-outline-secondary dropdown-toggle" type="button" (click)="toggleDropDown(!isDropDownOpen)"></button>\n    </div>\n  </div>\n  <div class="uselect__dropdown form-control">\n    <div class="uselect__search input-group">\n      <input type="text" class="form-control"\n        [(ngModel)]="search"\n        (ngModelChange)="onSearchChange()"\n        (keydown)="onSearchKeydown($event)"\n        tabindex="0"\n        #uselectSearch />\n    </div>\n    <div class="uselect__items">\n      <div *ngFor="let dataItem of items; let i = index; trackByIndex"\n        class="uselect__item"\n        [class.uselect__item--selected]="isCurrent(dataItem)"\n        [class.uselect__item--highlighted]="highlightedIndex == i"\n        (click)="selectItem(dataItem)">\n        <ng-container\n          *ngTemplateOutlet="dropDownTemplate; context: {$implicit: dataItem}">\n        </ng-container>\n        <ng-container *ngIf="!dropDownTemplate">\n          {{dropDownValue(dataItem)}}\n        </ng-container>\n      </div>\n    </div>\n  </div>\n</div>\n',styles:[":host{display:-webkit-box;display:-ms-flexbox;display:flex;max-height:100%}:host .uselect__holder{width:100%;position:relative}:host .uselect__holder.uselect__holder--disabled .form-control{background-color:#e9ecef;color:#212529}:host .uselect__holder.uselect__holder--disabled .form-control .btn{display:none}:host .uselect__holder .uselect__select{width:100%;max-height:100%}:host .uselect__holder .uselect__select>.form-control{padding:6px;max-height:100%}:host .uselect__holder .uselect__select .uselect__btn-dropdown{height:100%}:host .uselect__holder .uselect__select .uselect__selected-items{width:100%;max-height:100%;overflow:auto}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item{display:-webkit-box;display:-ms-flexbox;display:flex;width:100%;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 3px}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item+.uselect__select-item{margin-top:3px}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item.uselect__select-item--draggable{-webkit-transform:scale(.95);transform:scale(.95);border:1px dashed #cecece;border-radius:2px;background:rgba(255,255,255,.8)}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item span.uselect__select-item-template{width:100%;max-width:100%;overflow:hidden}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item .btn[uselectsortablehandle]{cursor:move}:host .uselect__holder .uselect__select .uselect__selected-items .uselect__select-item .btn[uselectsortablehandle]:hover{background-color:#f8f9fa;border-color:#f8f9fa}:host .uselect__holder .uselect__dropdown{position:absolute;z-index:2147483647;display:none}:host .uselect__holder.uselect__dropdown--open .uselect__select>div{border-bottom-left-radius:0}:host .uselect__holder.uselect__dropdown--open .uselect__select .uselect__btn-dropdown{border-bottom-right-radius:0}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown{display:block;border-top-left-radius:0;border-top-right-radius:0;border-top:none;padding:0;width:100%}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__search{width:100%;padding:5px}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__items{max-height:33vh;overflow-x:hidden;overflow-y:auto}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__items .uselect__item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:5px 8px}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__items .uselect__item.uselect__item--highlighted,:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__items .uselect__item:hover{cursor:pointer;background-color:#f8f9fa;color:#212529}:host .uselect__holder.uselect__dropdown--open .uselect__dropdown .uselect__items .uselect__item.uselect__item--selected{background-color:#007bff;color:#fff}"],providers:[{provide:s.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return l}),multi:!0}]}]}],l.ctorParameters=function(){return[{type:r}]},l.propDecorators={placeholder:[{type:t.Input,args:["placeholder"]}],service:[{type:t.Input,args:["service"]}],serviceMethod:[{type:t.Input,args:["serviceMethod"]}],serviceMethodArgs:[{type:t.Input,args:["serviceMethodArgs"]}],itemId:[{type:t.Input,args:["itemId"]}],servicePipe:[{type:t.Input,args:["pipe"]}],pipeArgs:[{type:t.Input,args:["pipeArgs"]}],dropDownValueFunc:[{type:t.Input,args:["dropDownValue"]}],selectedValueFunc:[{type:t.Input,args:["selectedValue"]}],dropDownTemplate:[{type:t.Input,args:["dropDownTemplate"]}],selectTemplate:[{type:t.Input,args:["selectTemplate"]}],sortKey:[{type:t.Input,args:["sortKey"]}],disabled:[{type:t.Input,args:["disabled"]}],disableEmpty:[{type:t.Input,args:["disableEmpty"]}],deleteKey:[{type:t.Input,args:["deleteKey"]}],uselectSearch:[{type:t.ViewChild,args:["uselectSearch"]}],clickedOutside:[{type:t.HostListener,args:["document:click",["$event"]]}]};var i=function(){function e(e){this.el=e}return e.prototype.onDragStart=function(e){return e.dataTransfer.effectAllowed="move",!0},e.prototype.onDragEnd=function(e){return!0},e}();i.decorators=[{type:t.Directive,args:[{selector:"[uselectSortableData]"}]}],i.ctorParameters=function(){return[{type:t.ElementRef}]},i.propDecorators={uselectSortableData:[{type:t.Input,args:["uselectSortableData"]}],onDragStart:[{type:t.HostListener,args:["dragstart",["$event"]]}],onDragEnd:[{type:t.HostListener,args:["dragend",["$event"]]}]};var a=function(){function e(){this._md=!1}return Object.defineProperty(e.prototype,"isMouseDown",{get:function(){return this._md},enumerable:!0,configurable:!0}),e.prototype.onmousedown=function(){return this._md=!0},e.prototype.onmouseup=function(){return!(this._md=!1)},e.prototype.onmouseleave=function(){return!(this._md=!1)},e}();a.decorators=[{type:t.Directive,args:[{selector:"[uselectSortableHandle]"}]}],a.propDecorators={onmousedown:[{type:t.HostListener,args:["mousedown"]}],onmouseup:[{type:t.HostListener,args:["mouseup"]}],onmouseleave:[{type:t.HostListener,args:["mouseleave"]}]};var c=function(){function e(e){this.el=e,this.uselectIndexChange=new t.EventEmitter,this.uselectDragstart=new t.EventEmitter}return e.prototype.onMouseDown=function(e){return undefined==this.uselectSortableIndex||(this.uselectSortableHandler&&this.uselectSortableHandler.isMouseDown||!this.uselectSortableHandler)&&(this.el.nativeElement.draggable=!0,this.el.nativeElement.classList.add("uselect__select-item--draggable"),this.uselectDragstart.emit(this.uselectSortableIndex)),!0},e.prototype.onDragEnd=function(e){return this.el.nativeElement.draggable=!1,this.el.nativeElement.classList.remove("uselect__select-item--draggable"),!0},e.prototype.onDragOver=function(e){return e.dataTransfer.dropEffect="move",this.uselectIndexChange.emit(this.uselectSortableIndex),!1},e.prototype.onDrag=function(e){if(!e.target.classList.contains("uselect__select-item"))return!0;var t=e.target.closest(".uselect__selected-items");return.8*t.offsetHeight<e.target.offsetTop-t.scrollTop?t.scrollTop=t.scrollTop+e.target.offsetHeight:.2*t.offsetHeight>e.target.offsetTop-t.scrollTop&&(t.scrollTop=t.scrollTop-e.target.offsetHeight),!0},e}();c.decorators=[{type:t.Directive,args:[{selector:"[uselectSortableIndex]",host:{draggable:"false",uselectsortable:"true"}}]}],c.ctorParameters=function(){return[{type:t.ElementRef}]},c.propDecorators={uselectSortableIndex:[{type:t.Input,args:["uselectSortableIndex"]}],uselectIndexChange:[{type:t.Output,args:["onUselectIndexChange"]}],uselectDragstart:[{type:t.Output,args:["onUselectDragstart"]}],uselectSortableHandler:[{type:t.ContentChild,args:[a]}],onMouseDown:[{type:t.HostListener,args:["mousedown",["$event"]]}],onDragEnd:[{type:t.HostListener,args:["dragend",["$event"]]}],onDragOver:[{type:t.HostListener,args:["dragover",["$event"]]}],onDrag:[{type:t.HostListener,args:["drag",["$event"]]}]};var d=function(){};d.decorators=[{type:t.NgModule,args:[{imports:[o.CommonModule,s.FormsModule],declarations:[l,i,c,a],providers:[r],exports:[l]}]}],e.UselectModule=d,e.ɵb=r,e.ɵa=l,e.ɵc=i,e.ɵd=a,e.ɵe=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-uselect.umd.min.js.map
